# CesiumJS大規模点群表示ガイド

このガイドでは、CesiumJSを使用して2億点クラスの大規模点群データを効率的に表示する方法を説明します。

## 1. CesiumJSの特徴

### 地理空間データ表示に特化
- **3D地球表示**: 地理空間座標系での自然な表示
- **自動LOD**: 距離に応じた自動詳細度調整
- **視錐台カリング**: 見えない部分の自動除外
- **高性能レンダリング**: WebGL最適化による高速表示

### 大規模データ対応
- **メモリ効率**: 必要な部分だけを読み込み
- **段階的表示**: 初期は粗い表示、ズーム時に詳細化
- **バッチ処理**: 大量データの効率的な処理

## 2. 使用方法

### 基本的な使用手順

1. **CesiumJSビューアに切り替え**
   - "CesiumJSビューア切り替え"ボタンをクリック
   - 3D地球表示に切り替わります

2. **LASファイルをアップロード**
   - ファイル選択でLASファイルを指定
   - 自動的にCesiumJSで表示されます

3. **表示の操作**
   - マウスで地球を回転・ズーム
   - 点群データが3D地球上に表示されます

### 表示設定

- **点のサイズ**: スライダーで調整
- **色表示**: 色情報の有効/無効切り替え
- **透明度**: 点の透明度調整

## 3. パフォーマンス最適化

### 自動最適化機能

1. **LOD（Level of Detail）**
   - 距離に応じた自動詳細度調整
   - 遠景では粗い表示、近景では詳細表示

2. **視錐台カリング**
   - カメラの視野外のデータは表示しない
   - メモリ使用量を大幅に削減

3. **バッチ処理**
   - 大量データを小さなバッチに分割
   - UIをブロックしない非同期処理

### メモリ管理

- **初期読み込み**: 500万点まで（全体形状把握）
- **段階的読み込み**: ズーム時に詳細データを追加
- **自動アンロード**: 不要なデータの自動削除

## 4. 地理空間座標系

### 座標変換
- LASファイルの座標を地理座標系に変換
- 経度・緯度・高度での表示
- 3D地球上での自然な配置

### 座標系の設定
```javascript
// 座標変換の例
const longitude = point.x; // 経度
const latitude = point.y;  // 緯度
const height = point.z;    // 高度
```

## 5. トラブルシューティング

### よくある問題

1. **メモリ不足**
   - 初期読み込み点数を削減
   - バッチサイズを調整

2. **表示が遅い**
   - 点のサイズを小さくする
   - 色表示を無効にする

3. **色が表示されない**
   - LASファイルに色情報が含まれているか確認
   - 色表示ボタンが有効になっているか確認

### デバッグ方法

```javascript
// ブラウザのコンソールで確認
console.log('CesiumJSビューア状態:', cesiumViewerRef.current);
console.log('点群データ数:', pointCloudInfo?.count);
```

## 6. ベストプラクティス

### データ準備
1. **LASファイルの確認**
   - 色情報が含まれているか確認
   - 座標系が適切か確認

2. **ファイルサイズの考慮**
   - 2億点クラスのデータでも効率的に表示
   - 初期表示は500万点まで

### パフォーマンス
1. **初期表示**
   - 全体の形状を把握できる粗い表示
   - 段階的に詳細度を向上

2. **ユーザー操作**
   - ズームイン時に詳細データを読み込み
   - ズームアウト時に粗い表示に切り替え

## 7. 技術仕様

### 対応データ形式
- **LAS**: 点群データの標準形式
- **LAZ**: 圧縮LAS形式
- **PLY**: ポリゴンファイル形式

### 表示機能
- **3D地球表示**: 地理空間での自然な表示
- **自動LOD**: 距離に応じた詳細度調整
- **色情報表示**: RGB色情報の表示
- **透明度調整**: 点の透明度制御

### パフォーマンス
- **初期表示**: 500万点まで
- **最大表示**: 2億点クラス対応
- **メモリ効率**: 必要な部分だけを読み込み
- **レンダリング**: WebGL最適化

これで、CesiumJSを使用した大規模点群データの効率的な表示が可能になります！
